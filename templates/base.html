<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}SmartHub{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
/* FIX: invisible text in select dropdowns */
select.form-control,
select.form-control option {
    color: #212529 !important;    
    background-color: #fff !important;
}

/* Dark mode styles */
[data-theme="dark"] {
    background-color: #121212;
    color: #e0e0e0;
}

[data-theme="dark"] .navbar {
    background-color: #1f2937 !important;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
}

[data-theme="dark"] .navbar-brand,
[data-theme="dark"] .nav-link {
    color: #f8f9fa !important;
}

[data-theme="dark"] .navbar-brand:hover,
[data-theme="dark"] .nav-link:hover {
    color: #dee2e6 !important;
}

[data-theme="dark"] main {
    background-color: #121212;
    color: #e0e0e0;
    min-height: calc(100vh - 200px);
}

[data-theme="dark"] .card {
    background-color: #1f2937;
    border-color: #374151;
    color: #e0e0e0;
}

[data-theme="dark"] .card-header {
    background-color: #2d3748;
    border-bottom-color: #374151;
    color: #e0e0e0;
}

[data-theme="dark"] .form-control,
[data-theme="dark"] .form-select {
    background-color: #2d3748;
    border-color: #4b5563;
    color: #e0e0e0;
}

[data-theme="dark"] .form-control:focus,
[data-theme="dark"] .form-select:focus {
    background-color: #374151;
    border-color: #6b7280;
    color: #e0e0e0;
    box-shadow: 0 0 0 0.2rem rgba(75, 85, 99, 0.25);
}

[data-theme="dark"] .table {
    background-color: #1f2937;
    color: #e0e0e0;
}

[data-theme="dark"] .table th,
[data-theme="dark"] .table td {
    border-color: #374151;
}

[data-theme="dark"] .btn-outline-primary {
    color: #3b82f6;
    border-color: #3b82f6;
}

[data-theme="dark"] .btn-outline-primary:hover {
    background-color: #3b82f6;
    color: #1f2937;
}

[data-theme="dark"] .alert {
    border-color: #4b5563;
}

[data-theme="dark"] footer {
    background-color: #1f2937 !important;
    color: #e0e0e0;
    border-top: 1px solid #374151;
}

/* Theme toggle button */
.theme-toggle {
    background: none;
    border: none;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.theme-toggle:hover {
    background-color: rgba(255,255,255,0.1);
}

[data-theme="dark"] .theme-toggle:hover {
    background-color: rgba(0,0,0,0.2);
}
</style>
</head>
<body data-theme="light">

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <!-- Brand / Home -->
        <a class="navbar-brand fw-bold" href="{% url 'dashboard:dashboard_redirect' %}">SmartHub</a>

        <!-- Theme Toggle -->
        <button class="theme-toggle navbar-toggler me-2 d-lg-none" id="themeToggleMobile" aria-label="Toggle theme">
            <i class="fas fa-moon"></i>
        </button>

        <!-- Toggler for small screens -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navbar links -->
        <div class="collapse navbar-collapse" id="mainNavbar">
            <ul class="navbar-nav ms-auto">
                {% if user.is_authenticated %}
                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/dashboard/' %}active{% endif %}"
                    href="{% url 'dashboard:dashboard_redirect' %}">
                        Dashboard
                    </a>
                </li>

                <li class="nav-item">
                    <span class="nav-link text-white">{{ user.username }}</span>
                </li>

                <li class="nav-item">
                    <!-- Theme Toggle Desktop -->
                    <button class="theme-toggle me-3" id="themeToggleDesktop" aria-label="Toggle theme">
                        <i class="fas fa-moon"></i>
                    </button>
                </li>

                <li class="nav-item">
                    <form method="post" action="{% url 'accounts:logout' %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-link nav-link text-warning p-0" style="border:none; background:none;">
                            Logout
                        </button>
                    </form>
                </li>
                {% else %}
                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/accounts/login/' %}active{% endif %}" href="{% url 'accounts:login' %}">
                        Login
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/accounts/register/' %}active{% endif %}" href="{% url 'accounts:register' %}">
                        Sign Up
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<!-- MAIN CONTENT -->
<main class="container mt-4">
    {% if messages %}
        {% for message in messages %}
            {% if message.tags == "error" %}
                <div class="alert alert-danger">{{ message }}</div>
            {% elif message.tags == "info" %}
                <div class="alert alert-info">
                    {{ message }} 
                    <a href="{% url 'signup' %}" class="alert-link">Sign up here</a>.
                </div>
            {% else %}
                <div class="alert alert-secondary">{{ message }}</div>
            {% endif %}
        {% endfor %}
    {% endif %}

    {% block content %}{% endblock %}
</main>

<!-- FOOTER -->
<footer class="mt-5 py-3 bg-light text-center">
    &copy; 2026 SmartHub
</footer>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script>
// Theme toggle functionality
document.addEventListener('DOMContentLoaded', function() {
    const html = document.documentElement;
    const body = document.body;
    const toggles = document.querySelectorAll('.theme-toggle');
    
    // Load saved theme or default to light
    const savedTheme = localStorage.getItem('theme') || 'light';
    body.setAttribute('data-theme', savedTheme);
    updateToggleIcons(savedTheme);
    
    // Toggle theme function
    function toggleTheme() {
        const currentTheme = body.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        
        body.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        updateToggleIcons(newTheme);
    }
    
    // Update toggle icons (sun/moon)
    function updateToggleIcons(theme) {
        const icons = document.querySelectorAll('.theme-toggle i');
        icons.forEach(icon => {
            if (theme === 'dark') {
                icon.className = 'fas fa-sun'; // Show sun in dark mode
            } else {
                icon.className = 'fas fa-moon'; // Show moon in light mode
            }
        });
    }
    
    // Add event listeners to all toggle buttons
    toggles.forEach(toggle => {
        toggle.addEventListener('click', toggleTheme);
    });
});
</script>

</body>
</html>
